<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Library Admin Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/> 
  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:Arial, sans-serif;}
    body{background:#f4f6f9;display:flex;min-height:100vh;}

    /* Sidebar */
    .sidebar{
      width:220px;height:100vh;background:#2c3e50;color:#fff;position:fixed;
      padding:20px;top:0;left:0;overflow-y:auto;transition:0.3s;
    }
    .sidebar h2{text-align:center;margin-bottom:25px;font-size:20px;}
    .sidebar a{
      display:block;color:#fff;text-decoration:none;padding:12px;margin:6px 0;
      border-radius:6px;transition:.3s;font-size:15px;
    }
    .sidebar a:hover{background:#34495e;}

    /* Toggle for mobile */
    .menu-toggle{
      display:none;font-size:22px;background:#2980b9;color:#fff;border:none;
      padding:8px 12px;border-radius:6px;cursor:pointer;
    }

    /* Main */
    .main{margin-left:240px;padding:20px;flex:1;display:flex;flex-direction:column;transition:0.3s;}
    .header{display:flex;justify-content:space-between;align-items:center;margin-bottom:25px;flex-wrap:wrap;gap:15px;}
    .header h1{font-size:22px;}
    .profile{display:flex;align-items:center;gap:15px;}
    .profile button{
      background:#e74c3c;color:white;border:none;padding:8px 14px;
      border-radius:6px;cursor:pointer;transition:.3s;
    }
    .profile button:hover{background:#c0392b;}

    /* Stats */
    .stats-cards{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
      gap:20px;margin-bottom:30px;
    }
    .card{
      background:linear-gradient(135deg,#2980b9,#6dd5fa);
      padding:25px;border-radius:14px;text-align:center;
      box-shadow:0 4px 12px rgba(0,0,0,0.12);color:white;
    }
    .card i{font-size:30px;margin-bottom:10px;}
    .card h3{font-size:26px;margin-bottom:6px;}

 
    .preview{text-align:center;margin:12px 0;}
    .preview img{width:120px;height:160px;object-fit:cover;border-radius:6px;}

    /* Search */
    .search-box{margin:25px 0;}
    .search-box input{
      width:100%;padding:12px 16px;border:2px solid #2980b9;border-radius:10px;
      font-size:15px;outline:none;transition:0.3s;
    }
    .search-box input:focus{
      border-color:#1f6391;
      box-shadow:0 0 6px rgba(41,128,185,0.4);
    }

    /* Alphabet Filter */
    .alphabet-filter {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 20px 0;
      justify-content: center;
    }
    .alphabet-filter button {
      padding: 8px 12px;
      border: none;
      border-radius: 20px;
      background: #ecf0f1;
      cursor: pointer;
      font-size: 14px;
      transition: 0.3s;
    }
    .alphabet-filter button:hover {
      background: #2980b9;
      color: white;
    }
    .alphabet-filter button.active {
      background: #2980b9;
      color: white;
      font-weight: bold;
    }

    /* Books grid */
    .books-grid{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(180px,1fr));
      gap:20px;
    }
    .book-card{
      background:white;padding:12px;border-radius:12px;
      box-shadow:0 2px 6px rgba(0,0,0,0.1);text-align:center;transition:.3s;
    }
    .book-card:hover{transform:translateY(-5px);box-shadow:0 4px 10px rgba(0,0,0,0.15);}
    .book-card img{
      width:100%;height:230px;object-fit:cover;border-radius:10px;
    }
    .book-card h4{margin:10px 0 5px;font-size:15px;}
    .book-card p{font-size:13px;color:gray;}

    /* Responsive */
    @media(max-width:992px){
      .main{margin-left:200px;}
    }
    @media(max-width:768px){
      .sidebar{position:fixed;left:-100%;z-index:1000;}
      .sidebar.active{left:0;}
      .main{margin-left:0;}
      .menu-toggle{display:block;margin-bottom:10px;}
    }
    @media(max-width:480px){
      .header h1{font-size:18px;}
      .card h3{font-size:22px;}
      .form-container{padding:15px;}
    }
  </style>
</head>
<body> 
  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <h2>ðŸ“š Library</h2>
    <a href="/admin/dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
    <a href="/admin/manage-books"><i class="fas fa-book"></i> Manage Books</a>
    <a href="/admin/manage-students"><i class="fas fa-user-graduate"></i> Manage Students</a>
    <a href="/admin/manage-allUsers"><i class="fas fa-user"></i> Manage Users</a>
  </div>

  <!-- Main -->
  <div class="main"> 
    <!-- Header -->
    <div class="header">
      <button class="menu-toggle" id="menuToggle"><i class="fas fa-bars"></i></button>
      <h1 id="welcomeText"></h1>
      <div class="profile">
        <div id="adminIcon"><i class="fas fa-user-shield"></i></div>
        <button id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</button>
      </div>
    </div> 

    <!-- Stats Cards -->
    <div class="stats-cards">
      <div class="card">
        <i class="fas fa-book"></i>
        <h3 id="totalBooks"></h3>
        <p>Total Books</p>
      </div>
    </div>

    <!-- Add Book Form -->

    <!-- Search -->
    <div class="search-box">
      <input type="text" id="searchInput" placeholder="Search books...">
    </div> 

    <!-- Alphabet Filter -->
    <div class="alphabet-filter" id="alphabetFilter"></div>

    <!-- Books Grid -->
    <h3>ðŸ“Œ Books Collection</h3>
    <div class="books-grid" id="booksGrid"></div>
  </div> 

<script>
const sidebar=document.getElementById("sidebar");
const menuToggle=document.getElementById("menuToggle");
menuToggle.addEventListener("click",()=>{sidebar.classList.toggle("active");});

const booksGrid=document.getElementById("booksGrid");
const searchInput=document.getElementById("searchInput");
const logoutBtn=document.getElementById("logoutBtn");
const addBookBtn=document.getElementById("addBookBtn");
const coverInput=document.getElementById("cover");
const preview=document.getElementById("preview");
const totalBooks=document.getElementById("totalBooks");
const welcomeText=document.getElementById("welcomeText");
const alphabetFilter=document.getElementById("alphabetFilter");

let books=[];  

async function getBooks(){
  const response=await fetch('http://localhost:5000/api/getBooks');
  if(response.ok){
    const data=await response.json();
    books=data;
    renderBooks(data);

  }else{
    console.error("Failed to fetch books");
  }
}


// âœ… Sort alphabetically
function sortBooks(){
  books.sort((a,b)=>a.title.localeCompare(b.title));
}


// âœ… Render Books
function renderBooks(data){
  booksGrid.innerHTML="";
  data.forEach(b=>{
    const card=document.createElement("div");
    card.classList.add("book-card");
    card.innerHTML=`
      <img src="${b.cover_url}" alt="${b.title}">
      <h4>${b.title}</h4>
      <p>${b.author}</p>
    `;
    booksGrid.appendChild(card);
  });
  totalBooks.textContent=books.length;
}

// âœ… Clear form
function clearForm(){
  document.getElementById("title").value="";
  document.getElementById("author").value="";
  coverInput.value="";
  preview.innerHTML="";
}

// âœ… Search filter
searchInput.addEventListener("keyup",e=>{
  const q=e.target.value.toLowerCase();
  renderBooks(books.filter(b=>b.title.toLowerCase().includes(q)));
});

// âœ… Alphabet filter
const letters="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");

// "All" button
const allBtn=document.createElement("button");
allBtn.textContent="All";
allBtn.classList.add("active");
allBtn.addEventListener("click",()=>{
  document.querySelectorAll(".alphabet-filter button").forEach(b=>b.classList.remove("active"));
  allBtn.classList.add("active");
  renderBooks(books);
});
alphabetFilter.appendChild(allBtn);

// Aâ€“Z buttons
letters.forEach(letter=>{
  const btn=document.createElement("button");
  btn.textContent=letter;
  btn.addEventListener("click",()=>{
    document.querySelectorAll(".alphabet-filter button").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    const filtered=books.filter(b=>b.title.toLowerCase().startsWith(letter.toLowerCase()));
    renderBooks(filtered);
  });
  alphabetFilter.appendChild(btn);
});

// âœ… Logout
logoutBtn.addEventListener("click", async()=>{
  const response= await fetch('/logout');
  if(response.redirected){
    window.location.replace(response.url);
  }
});

// âœ… Page load
window.onload=async()=>{
  getBooks();
  renderBooks(books);
  const name= await cookieStore.get('name');
  welcomeText.textContent=`Welcome, ${decodeURIComponent(name?.value) || "Admin"}`;
};
</script>
</body>
</html>
